<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Planificare Vizite</title>
  <link rel="stylesheet" href="style.css" />

  <!-- SheetJS (Excel import/export) -->
  <script defer src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script defer src="app.js"></script>
</head>

<body>
  <!-- =============== AUTH OVERLAY =============== -->
  <div id="authOverlay" class="overlay">
    <div class="authCard">
      <div class="authHeader">
        <div class="logo">PV</div>
        <div>
          <div class="title">Planificare Vizite</div>
          <div class="subtitle">Login</div>
        </div>
      </div>

      <div class="authBody">
        <input id="loginUser" placeholder="Utilizator" autocomplete="username" />
        <input id="loginPass" placeholder="ParolÄƒ" type="password" autocomplete="current-password" />
        <button class="btn" id="btnLogin">IntrÄƒ</button>

        <div class="hint">
          Implicit: <b>admin</b> / <b>admin123</b> (coordonator). SchimbÄƒ parola dupÄƒ login din SetÄƒri Utilizatori.
        </div>
        <div id="loginError" class="errorText"></div>
      </div>
    </div>
  </div>

  <!-- =============== CLIENT DETAILS MODAL =============== -->
  <div id="clientModal" class="overlay hidden">
    <div class="modalCard">
      <div class="modalTop">
        <div>
          <div class="modalTitle" id="cmTitle">FiÈ™Äƒ Client</div>
          <div class="hint" id="cmSubtitle"></div>
        </div>
        <button class="btn ghost" id="btnCloseClientModal">Ãnchide</button>
      </div>

      <div class="modalBody">
        <div class="grid2">
          <div class="card flat">
            <h3>Date client</h3>
            <div class="form">
              <label class="field">
                <span>Nume</span>
                <input id="cmName" />
              </label>
              <label class="field">
                <span>JudeÈ›</span>
                <input id="cmCounty" placeholder="ex: Maramures" />
              </label>
              <label class="field">
                <span>AdresÄƒ</span>
                <input id="cmAddress" placeholder="stradÄƒ, nr, localitate..." />
              </label>
              <label class="field">
                <span>Telefon</span>
                <input id="cmPhone" placeholder="07xx..." />
              </label>

              <div class="divider"></div>

              <h4>FrecvenÈ›Äƒ vizite (lunar)</h4>
              <div class="row wrap">
                <div class="stepper">
                  <button class="stepBtn" id="cmMinus" type="button">âˆ’</button>
                  <div class="stepVal" id="cmCount">0</div>
                  <button class="stepBtn" id="cmPlus" type="button">+</button>
                </div>
                <div class="hint">nr vizite/lunÄƒ</div>
              </div>

              <div class="divider"></div>

              <h4>SÄƒptÄƒmÃ¢ni vizite (S1â€“S5)</h4>
              <div id="cmWeeks" class="row wrap"></div>

              <div class="divider"></div>

              <button class="btn" id="btnSaveClientModal">SalveazÄƒ</button>
            </div>
          </div>

          <div class="card flat">
            <h3>Persoane de contact</h3>
            <div class="hint">PoÈ›i adÄƒuga oricÃ¢te contacte. (Nume + rol + telefon + email + observaÈ›ii)</div>

            <div id="cmContacts" class="stack"></div>

            <button class="btn ghost" id="btnAddContact">+ AdaugÄƒ contact</button>

            <div class="divider"></div>

            <h3>Rapoarte (viitor)</h3>
            <div class="hint">
              ZonÄƒ pregÄƒtitÄƒ pentru rapoarte automate din surse externe (vÃ¢nzÄƒri, ultimele discuÈ›ii etc.).
              Momentan doar placeholder.
            </div>
            <div class="reportBox">
              <div class="reportItem">
                <div class="k">Ultimele vÃ¢nzÄƒri</div>
                <div class="v muted">Neconfigurat</div>
              </div>
              <div class="reportItem">
                <div class="k">Sumar ultima lunÄƒ</div>
                <div class="v muted">Neconfigurat</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modalBottom">
        <button class="btn danger" id="btnDeleteClientModal">È˜terge client</button>
      </div>
    </div>
  </div>

  <!-- =============== APP =============== -->
  <header class="topbar">
    <div class="brand">
      <div class="logo">PV</div>
      <div>
        <div class="title">Planificare Vizite</div>
        <div class="subtitle" id="whoami">â€”</div>
      </div>
    </div>

    <div class="top-actions">
      <button class="btn ghost" id="btnLogout">Logout</button>
      <button class="btn ghost" id="btnReset">Reset date</button>
      <button class="btn" id="btnExport">ğŸ“¤ Export Excel</button>
    </div>
  </header>

  <main class="container">
    <nav class="tabs" role="tablist">
      <button class="tab active" data-tab="tab-clients">ClienÈ›i</button>
      <button class="tab" data-tab="tab-agents">AgenÈ›i & Rute</button>
      <button class="tab" data-tab="tab-activities">ActivitÄƒÈ›i</button>
      <button class="tab" data-tab="tab-plan">Planificare</button>
      <button class="tab" data-tab="tab-reports">Raport</button>
      <button class="tab" data-tab="tab-users" id="tabUsersBtn">Utilizatori</button>
    </nav>

    <!-- ============ CLIENTS ============ -->
    <section id="tab-clients" class="panel active">
      <div class="grid2">
        <div class="card">
          <h2>Import clienÈ›i din Excel</h2>
          <p class="hint">
            Se cautÄƒ automat coloane: <b>Client/Nume</b>, <b>JudeÈ›</b>, <b>AdresÄƒ</b>, <b>Telefon</b>.
            Deduplicare: <b>Nume + JudeÈ›</b> (fallback pe Nume).
          </p>

          <input type="file" id="fileClients" accept=".xlsx,.xls" />
          <div class="row wrap">
            <label class="inline">
              Sheet:
              <input id="sheetName" placeholder="(gol = primul sheet)" />
            </label>
            <button class="btn" id="btnImportClients">ImportÄƒ</button>
          </div>

          <div class="divider"></div>

          <h3>AdaugÄƒ client manual</h3>
          <div class="form">
            <input id="newClientName" placeholder="Nume client" />
            <input id="newClientCounty" placeholder="JudeÈ› (opÈ›ional)" />
            <input id="newClientAddress" placeholder="AdresÄƒ (opÈ›ional)" />
            <input id="newClientPhone" placeholder="Telefon (opÈ›ional)" />
            <button class="btn" id="btnAddClient">AdaugÄƒ client</button>
          </div>
        </div>

        <div class="card">
          <h2>Lista clienÈ›i</h2>

          <div class="row wrap">
            <input id="clientSearch" placeholder="CautÄƒ client..." />
            <button class="btn ghost" id="btnClearClients">È˜terge toÈ›i clienÈ›ii</button>
          </div>

          <div class="table-wrap">
            <table class="table" id="tblClients">
              <thead>
                <tr>
                  <th>Client</th>
                  <th>JudeÈ›</th>
                  <th>Telefon</th>
                  <th>AdresÄƒ</th>
                  <th>Vizite/lunÄƒ</th>
                  <th>SÄƒpt.</th>
                  <th></th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <p class="hint">
            Click pe un client â†’ deschide <b>FiÈ™a Client</b> (contacte, date complete, rapoarte viitoare).
          </p>
        </div>
      </div>
    </section>

    <!-- ============ AGENTS & ROUTES ============ -->
    <section id="tab-agents" class="panel">
      <div class="grid2">
        <div class="card">
          <h2>AgenÈ›i</h2>
          <div class="hint">Coordonatorul poate gestiona agenÈ›i. Agentul vede doar datele lui.</div>

          <div class="form">
            <input id="newAgentName" placeholder="Nume agent" />
            <button class="btn" id="btnAddAgent">AdaugÄƒ agent</button>
          </div>

          <div class="table-wrap">
            <table class="table" id="tblAgents">
              <thead><tr><th>Agent</th><th></th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <div class="card">
          <h2>Rute</h2>
          <div class="form">
            <input id="newRouteName" placeholder="Nume rutÄƒ" />
            <select id="newRouteAgent"></select>
            <button class="btn" id="btnAddRoute">AdaugÄƒ rutÄƒ</button>
          </div>

          <div class="table-wrap">
            <table class="table" id="tblRoutes">
              <thead><tr><th>RutÄƒ</th><th>Agent</th><th></th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
          <p class="hint">PoÈ›i lÄƒsa agentul gol la rutÄƒ dacÄƒ vrei.</p>
        </div>
      </div>
    </section>

    <!-- ============ ACTIVITIES ============ -->
    <section id="tab-activities" class="panel">
      <div class="grid2">
        <div class="card">
          <h2>ListÄƒ activitÄƒÈ›i (configurabilÄƒ)</h2>
          <p class="hint">ActivitÄƒÈ›ile se selecteazÄƒ multiple la vizitÄƒ + existÄƒ cÃ¢mp â€Altcevaâ€.</p>

          <div class="form">
            <input id="newActivityName" placeholder="Ex: comanda" />
            <button class="btn" id="btnAddActivity">AdaugÄƒ activitate</button>
          </div>

          <div class="table-wrap">
            <table class="table" id="tblActivities">
              <thead><tr><th>Activitate</th><th></th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <div class="card">
          <h2>NotiÈ›e</h2>
          <ul class="hint">
            <li>Ãn export, activitÄƒÈ›ile multiple sunt concatenate Ã®ntr-o singurÄƒ celulÄƒ.</li>
            <li>Ziua se calculeazÄƒ automat din datÄƒ (fÄƒrÄƒ diacritice).</li>
            <li>Format export: <b>Zi | Data | Client | Activitate | Detalii | Observatii</b>.</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- ============ PLANNING ============ -->
    <section id="tab-plan" class="panel">
      <div class="card">
        <h2>Interval planificare</h2>

        <div class="row wrap">
          <label class="inline">
            De la:
            <input type="date" id="fromDate" />
          </label>
          <label class="inline">
            PÃ¢nÄƒ la:
            <input type="date" id="toDate" />
          </label>

          <div class="grow"></div>

          <label class="inline" id="agentFilterWrap">
            Agent:
            <select id="agentFilter"></select>
          </label>

          <button class="btn" id="btnGenerate">GenereazÄƒ vizite (din frecvenÈ›e)</button>
          <button class="btn ghost" id="btnClearVisits">È˜terge vizitele din interval</button>
        </div>

        <p class="hint">
          Generarea creeazÄƒ vizite Ã®n sÄƒptÄƒmÃ¢nile selectate per client. Apoi le poÈ›i ajusta manual Ã®n tabel.
          Agent-ul vede doar vizitele lui.
        </p>
      </div>

      <div class="card">
        <h2>AdaugÄƒ vizitÄƒ manual</h2>
        <div class="grid3">
          <input type="date" id="visitDate" />
          <select id="visitClient"></select>
          <select id="visitAgent"></select>
          <select id="visitRoute"></select>

          <div class="multibox">
            <div class="label">ActivitÄƒÈ›i (multiple)</div>
            <div id="visitActivities" class="chips"></div>
          </div>

          <input id="visitOtherActivity" placeholder="Altceva (opÈ›ional)" />
          <input id="visitDetails" placeholder="Detalii (opÈ›ional)" />
          <input id="visitObs" placeholder="Observatii (opÈ›ional)" />

          <button class="btn" id="btnAddVisit">AdaugÄƒ vizitÄƒ</button>
        </div>
      </div>

      <div class="card">
        <h2>Vizite Ã®n interval</h2>
        <div class="row wrap">
          <label class="inline">
            Sortare:
            <select id="sortMode">
              <option value="date">Data</option>
              <option value="client">Client</option>
              <option value="agent">Agent</option>
              <option value="route">Ruta</option>
            </select>
          </label>
          <button class="btn ghost" id="btnSort">SorteazÄƒ</button>
        </div>

        <div class="table-wrap">
          <table class="table" id="tblVisits">
            <thead>
              <tr>
                <th>Zi</th>
                <th>Data</th>
                <th>Client</th>
                <th>Agent</th>
                <th>Ruta</th>
                <th>Activitate</th>
                <th>Detalii</th>
                <th>Observatii</th>
                <th></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <p class="hint">
          Ziua este calculatÄƒ automat din Data. PoÈ›i edita celulele. Agent-ul nu poate vedea/edita vizitele altor agenÈ›i.
        </p>
      </div>
    </section>

    <!-- ============ REPORTS ============ -->
    <section id="tab-reports" class="panel">
      <div class="grid2">
        <div class="card">
          <h2>Raport (interval)</h2>
          <p class="hint">Raportul se bazeazÄƒ pe vizitele din intervalul ales (È™i filtrul de agent dacÄƒ e cazul).</p>

          <div class="row wrap">
            <button class="btn" id="btnRefreshReport">RecalculeazÄƒ raport</button>
          </div>

          <div class="stats" id="reportStats"></div>
        </div>

        <div class="card">
          <h2>DefiniÈ›ii</h2>
          <ul class="hint">
            <li><b>Nr. vizite</b> = numÄƒrul de rÃ¢nduri (vizite) planificate Ã®n interval.</li>
            <li><b>Nr. clienÈ›i unici</b> = cÃ¢È›i clienÈ›i diferiÈ›i apar Ã®n interval.</li>
            <li>Rapoarte automate pe client (vÃ¢nzÄƒri etc.) â€“ pregÄƒtite Ã®n FiÈ™a Client, de implementat ulterior.</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- ============ USERS (COORD ONLY) ============ -->
    <section id="tab-users" class="panel">
      <div class="grid2">
        <div class="card">
          <h2>Utilizatori (coordonator)</h2>
          <div class="hint">Aici creezi conturi pentru agenÈ›i È™i coordonatori. (Local-only)</div>

          <div class="form">
            <input id="newUsername" placeholder="Username (ex: ion.pop)" />
            <input id="newPassword" placeholder="ParolÄƒ" type="password" />
            <select id="newRole">
              <option value="agent">agent</option>
              <option value="coordonator">coordonator</option>
            </select>
            <select id="newUserAgent"></select>
            <button class="btn" id="btnCreateUser">CreeazÄƒ utilizator</button>
          </div>

          <p class="hint">
            Pentru rolul <b>agent</b>, selecteazÄƒ agentul asociat. Pentru coordonator, poÈ›i lÄƒsa necompletat.
          </p>
        </div>

        <div class="card">
          <h2>Lista utilizatori</h2>
          <div class="table-wrap">
            <table class="table" id="tblUsers">
              <thead><tr><th>Username</th><th>Rol</th><th>Agent</th><th></th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
          <p class="hint">Schimbarea parolei se face prin È™tergere + recreare (MVP). Putem extinde ulterior.</p>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <span>âœ”ï¸ Datele se salveazÄƒ local (Ã®n browser). Pentru securitate realÄƒ: Firebase/Supabase.</span>
  </footer>
</body>
</html>
